<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=0.8">
<title>Quiz Kosakata Korea</title>

<style>
body {
  font-family: sans-serif;
  background: #fffaf0;
  padding: 20px;
  line-height: 1.6;
  font-size: 22px; /* üîπ ukuran huruf utama */
}

.quiz { margin-bottom: 25px; }

button {
  padding: 15px 20px;
  border-radius: 10px;
  margin-top: 15px;
  font-size: 20px; /* üîπ ukuran huruf tombol */
}

#timer {
  font-weight: bold;
  color: red;
  font-size: 22px; /* üîπ ukuran tulisan waktu */
}
</style>
</head>
<body>

<h2>Sesi <span id="sesi"></span></h2>
<div id="timer"></div>
<hr>
<div id="quiz">Memuat soal...</div>
<!-- üîπ Popup custom waktu habis -->
<div id="popupWaktuHabis" style="
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  color:white;
  text-align:center;
  padding-top:40%;
  font-size:24px;
  z-index:999;
">
  ‚è∞ Waktu habis!<br>
  <button onclick="lihatHasil()">Lihat Hasil</button>
</div>
<button id="selesai" onclick="selesai()" style="display:none;">Selesai Sesi</button>

<script>
const csvURL = "https://raw.githubusercontent.com/ulilyusuf/quiz/refs/heads/main/kosakataeps.csv";
let kosakata = [];
let soal = [];
let sesi = parseInt(localStorage.getItem('sesi')) || 1;
let waktu = parseInt(localStorage.getItem('waktu_per_sesi')) * 60;
let skor = 0;
let index = 0;
let jawabanSalah = [];

document.getElementById('sesi').textContent = sesi;

async function loadCSV(){
  const res = await fetch(csvURL);
  const text = await res.text();
  kosakata = text.trim().split("\n").map(row => {
    const [korean, arti] = row.split(",");
    return {korean: korean.trim(), arti: arti.trim()};
  });
  buatSoal();
  tampilSoal();
  timer();
}

function acak(arr){ return arr.sort(() => Math.random() - 0.5); }

function buatSoal(){
  soal = acak([...kosakata]).slice(0,10).map(item => {
    let opsi = [item.arti];
    while(opsi.length < 4){
      let rand = kosakata[Math.floor(Math.random()*kosakata.length)].arti;
      if(!opsi.includes(rand)) opsi.push(rand);
    }
    opsi = acak(opsi);
    return { q: item.korean, opsi: opsi, correct: item.arti };
  });
}

function tampilSoal(){
  if(index >= soal.length){
    // Jika semua soal sudah dijawab
    let tombolLanjut = "";
    if(sesi < 10){
      tombolLanjut = `<button onclick="lanjutSesi()">‚û°Ô∏è Lanjut Sesi ${sesi+1}</button><br>`;
    }

    document.getElementById('quiz').innerHTML = `
      <h3>üéâ Sesi ${sesi} selesai!</h3>
      <p>Skor sementara: ${skor} / ${soal.length}</p>
      ${tombolLanjut}
      <button onclick="lihatHasil()">üìä Selesai dan Lihat Hasil</button>
    `;
    return;
  }

  let s = soal[index];
  document.getElementById('quiz').innerHTML = `
    <div class='question'>
      <p>${index+1}. Apa arti dari <b>${s.q}</b>?</p>
      ${s.opsi.map(o=>`<button onclick="jawab('${o}')">${o}</button>`).join("<br>")}
    </div>
  `;
}

function jawab(pilihan){
  let s = soal[index];
  if(pilihan === s.correct){
    skor++;
  } else {
    jawabanSalah.push({no:index+1, soal:s.q, jawaban:s.correct});
  }
  index++;
  tampilSoal();
}
  
function timer(){
  let t = setInterval(()=>{
    waktu--;
    document.getElementById('timer').textContent = "‚è±Ô∏è " + waktu + " detik tersisa";

    if (waktu <= 0) {
      clearInterval(t);
      waktuHabis(); // panggil fungsi khusus waktu habis
    }
  }, 1000);
}

function waktuHabis(){
  // Nonaktifkan semua tombol quiz
  document.querySelectorAll("button").forEach(btn => btn.disabled = true);

  // Simpan hasil sesi ke localStorage
  localStorage.setItem('skor_sesi_'+sesi, skor);
  localStorage.setItem('salah_sesi_'+sesi, JSON.stringify(jawabanSalah));

  // Tampilkan popup custom (tanpa alert browser)
  document.getElementById("popupWaktuHabis").style.display = "block";
}
  
function lihatHasil(){
  // Simpan hasil terakhir dulu
  localStorage.setItem('skor_sesi_'+sesi, skor);
  localStorage.setItem('salah_sesi_'+sesi, JSON.stringify(jawabanSalah));
  window.location.href = "https://ulilyusuf.github.io/quiz/result.html";
}

loadCSV();
</script>
</body>
</html>
