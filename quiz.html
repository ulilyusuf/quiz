<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=0.8">
<title>Quiz Kosakata Korea</title>
<style>
body {
  font-family: sans-serif;
  background: #fffaf0;
  padding: 20px;
  line-height: 1.6;
  font-size: 22px; /* ğŸ”¹ ukuran huruf utama */
}

.quiz { margin-bottom: 25px; }

button {
  padding: 15px 20px;
  border-radius: 10px;
  margin-top: 15px;
  font-size: 20px; /* ğŸ”¹ ukuran huruf tombol */
}

#timer {
  font-weight: bold;
  color: red;
  font-size: 22px; /* ğŸ”¹ ukuran tulisan waktu */
}
</style>
</head>
<body>

<h2>Sesi <span id="sesi"></span></h2>
<div id="timer"></div>
<hr>
<div id="quiz">Memuat soal...</div>

<button id="selesai" onclick="selesai()" style="display:none;">Selesai Sesi</button>

<script>
const csvURL = "https://raw.githubusercontent.com/ulilyusuf/quiz/refs/heads/main/kosakataeps.csv";
let kosakata = [];
let soal = [];
let sesi = parseInt(localStorage.getItem('sesi')) || 1;
let waktu = parseInt(localStorage.getItem('waktu_per_sesi')) * 60;
let skor = 0;
let index = 0;
let jawabanSalah = [];

document.getElementById('sesi').textContent = sesi;

async function loadCSV(){
  const res = await fetch(csvURL);
  const text = await res.text();
  kosakata = text.trim().split("\n").map(row => {
    const [korean, arti] = row.split(",");
    return {korean: korean.trim(), arti: arti.trim()};
  });
  buatSoal();
  tampilSoal();
  timer();
}

function acak(arr){ return arr.sort(() => Math.random() - 0.5); }

function buatSoal(){
  soal = acak([...kosakata]).slice(0,10).map(item => {
    let opsi = [item.arti];
    while(opsi.length < 4){
      let rand = kosakata[Math.floor(Math.random()*kosakata.length)].arti;
      if(!opsi.includes(rand)) opsi.push(rand);
    }
    opsi = acak(opsi);
    return { q: item.korean, opsi: opsi, correct: item.arti };
  });
}

function tampilSoal(){
  if(index >= soal.length){
    // Jika semua soal sudah dijawab
    let tombolLanjut = "";
    if(sesi < 10){
      tombolLanjut = `<button onclick="lanjutSesi()">â¡ï¸ Lanjut Sesi ${sesi+1}</button><br>`;
    }

    document.getElementById('quiz').innerHTML = `
      <h3>ğŸ‰ Sesi ${sesi} selesai!</h3>
      <p>Skor sementara: ${skor} / ${soal.length}</p>
      ${tombolLanjut}
      <button onclick="lihatHasil()">ğŸ“Š Selesai dan Lihat Hasil</button>
    `;
    return;
  }

  let s = soal[index];
  document.getElementById('quiz').innerHTML = `
    <div class='question'>
      <p>${index+1}. Apa arti dari <b>${s.q}</b>?</p>
      ${s.opsi.map(o=>`<button onclick="jawab('${o}')">${o}</button>`).join("<br>")}
    </div>
  `;
}

function jawab(pilihan){
  let s = soal[index];
  if(pilihan === s.correct){
    skor++;
  } else {
    jawabanSalah.push({no:index+1, soal:s.q, jawaban:s.correct});
  }
  index++;
  tampilSoal();
}
  
function timer(){
  let t = setInterval(()=>{
    waktu--;
    document.getElementById('timer').textContent = "â±ï¸ " + waktu + " detik tersisa";
    if(waktu <= 0){
      clearInterval(t);
      selesai();
    }
  }, 1000);
}

function lanjutSesi(){
  localStorage.setItem('skor_sesi_'+sesi, skor);
  localStorage.setItem('salah_sesi_'+sesi, JSON.stringify(jawabanSalah));

  if(sesi < 10){
    localStorage.setItem('sesi', sesi+1);
    window.location.reload(); // mulai sesi berikutnya
  } else {
    alert("Semua 10 sesi sudah selesai!");
    window.location.href = "https://ulilyusuf.github.io/quiz/result.html";
  }
}

function lihatHasil(){
  // Simpan hasil terakhir dulu
  localStorage.setItem('skor_sesi_'+sesi, skor);
  localStorage.setItem('salah_sesi_'+sesi, JSON.stringify(jawabanSalah));
  window.location.href = "https://ulilyusuf.github.io/quiz/result.html";
}

loadCSV();
</script>
</body>
</html>
